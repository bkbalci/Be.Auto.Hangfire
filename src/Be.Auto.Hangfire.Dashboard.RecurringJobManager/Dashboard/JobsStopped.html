<script src="../recurring-job-manager/js/vue"></script>
<script src="../recurring-job-manager/js/axio"></script>

<div id="app">
    <div class="col-md-3"></div>
    <div class="col-md-9">
        <h1 class="page-header">Stopped Jobs</h1>

        <div v-if="getItems.length === 0" class="alert alert-info">
            No stopped jobs found
        </div>
        <div v-else class="js-jobs-list">
            <div class="table-responsive">
                <table class="table">

                    <thead>
                        <tr>
                            <th>Id</th>
                            <th>Queue</th>
                            <th>Class</th>
                            <th>Method</th>
                            <th>TimeZone</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="job in getItems" :key="job.Id">
                            <td>{{ job.Id }}</td>
                            <td>{{ job.Queue }}</td>
                            <td>{{ job.Class }}</td>
                            <td>{{ job.Method }}</td>
                            <td>{{ job.TimeZoneId }}</td>
                        </tr>
                    </tbody>
                </table>

                <div style="float: right;">
                    <paginate :page-count="getPageCount"
                              :page-range="3"
                              :margin-pages="2"
                              :click-handler="clickCallbackPagination"
                              :prev-text="'＜'"
                              :next-text="'＞'"
                              :container-class="'pagination'"
                              :page-class="'page-item'">
                    </paginate>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { ref, computed, createApp } = Vue;

    const appJob = createApp({
        data() {
            return {
                jobs: null,
                pagination: {
                    parPage: 10,
                    currentPage: 1
                }
            }
        },
        methods: {
            GetJobs() {
                axios.get('get-job-stopped')
                    .then(res => (this.jobs = res.data));
            },
            clickCallbackPagination(pageNum) {
                this.pagination.currentPage = Number(pageNum);
            }
        },
        computed: {
            getItems() {
                if (this.jobs) {
                    let start = (this.pagination.currentPage - 1) * this.pagination.parPage;
                    let end = start + this.pagination.parPage;
                    return this.jobs.slice(start, end);
                }
                return [];
            },
            getPageCount() {
                return Math.ceil(this.jobs ? this.jobs.length / this.pagination.parPage : 0);
            }
        },
        created() {
            this.GetJobs();
        }
    });

    appJob.mount('#app');
</script>
